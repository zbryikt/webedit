var x$;x$=angular.module("webedit"),x$.controller("profile",["$scope","$http","$timeout","ldNotify"].concat(function(t,e,n,i){return t.doc={list:[],cur:[],idx:0,pageAt:function(t){return this.list[t]||t--,console.log(t,this.list[t]),this.cur=this.list[t],this.idx=t,this},fetch:function(){var t=this;return e({url:"/d/me/doc/",method:"GET"}).then(function(e){return e.data.map(function(t){return t.timestamp=new Date(t.modifiedtime||t.createdtime).getTime(),t.thumbnail?t.thumbnail=t.thumbnail.replace(/\/\d+x\d+\//,"/80x42/"):void 0}),t.raw=e.data,t.prepare()})},"delete":function(t){var e;return e=this.raw.indexOf(t),~e?(this.raw.splice(e,1),this.prepare()):void 0},prepare:function(){var t,e,n,i,r;for(this.raw.sort(function(t,e){return e.timestamp-t.timestamp}),this.list=[],t=0,e=Math.floor(this.raw.length/20);e>=t;++t)for(n=t,this.list.push([]),i=0;20>i&&(r=i,!(20*n+r>=this.raw.length));++i)this.list[n].push(this.raw[20*n+r]);return this.cur=this.list[this.idx]}},t.doc.fetch(),t.page={toggle:function(t,e){return t.target&&t.target.getAttribute&&/item|ctrl|list/.exec(t.target.getAttribute("class"))?e.toggled=!e.toggled:void 0},"delete":function(n){return t.loading=!0,e({url:"/d/page/"+n.slug+"/",method:"DELETE"})["finally"](function(){return t.loading=!1}).then(function(){return t.doc["delete"](n),i.send("success","Deleted")})["catch"](function(){return i.send("danger","failed. try again later?")})},thumbnail:function(e){var n,i;return n="1024x1024",i=uploadcare.openDialog(null,null,{imageShrink:n,crop:"free"}),i.done(function(n){var i,r;return i=((r=n.files)?r():[n])[0],t.$apply(function(){return e.thumbnailLoading=!0}),i.done(function(n){return t.$apply(function(){return e.thumbnail=n.cdnUrl+"",e.thumbnailLoading=!1,t.page.update(e)})})})},update:function(n,r){return null==r&&(r=!1),t.loading=!0,e({url:"/d/page/"+n.slug+"/",method:"PUT",data:{title:n.title,thumbnail:n.thumbnail,domain:n.domain,path:n.path,gacode:n.gacode}})["finally"](function(){return t.loading=!0}).then(function(){return t.loading=!1,r&&(n.toggled=!1),i.send("success","saved.")})["catch"](function(){return alert("failed to save. try again later")})}}}));