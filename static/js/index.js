function import$(t,n){var i={}.hasOwnProperty;for(var e in n)i.call(n,e)&&(t[e]=n[e]);return t}var x$;x$=angular.module("webedit",["ldBase","backend","ldColorPicker","ngAnimate"]),x$.factory("httpRequestInterceptor",["global"].concat(function(t){return{request:function(n){return n.headers["X-CSRF-Token"]=t.csrfToken,n}}})),x$.config(["$compileProvider","$httpProvider"].concat(function(t,n){return t.aHrefSanitizationWhitelist(/^\s*(blob:|http:\/\/localhost)|https:\/\/makeweb.io\//),n.interceptors.push("httpRequestInterceptor")})),x$.controller("site",["$scope","$http","$interval","global","ldBase","ldNotify","initWrap"].concat(function(t,n,i,e,r,o,a){return a=a(),import$(t,r),t.notifications=o.queue,t.staticMode=e["static"],t.$watch("user.data",function(n){return n&&n.key?(t.track("uv/"+n.key,(new Date).toISOString().substring(0,10)+"",window.location.pathname),gtag("config","GA_TRACKING_ID",{user_id:n.key})):void 0},!0),t.user={data:e.user},t.needlogin=function(n,i){return(t.user.data?Promise.resolve():t.auth.prompt()).then(function(){return window.location.href=((i?window.location.pathname+"/":"")+n).replace(/\/\//g,"/")})["catch"](function(){})},t.auth=a({init:function(){var n=this;return t.$watch("auth.ctrl.toggled",function(){return n.error={}})},email:"",displayname:"",passwd:"",stick:!1,subscribe:!0,config:{dismissOnEnter:!1,finish:function(){return t.auth.login()}},verify:function(){return this.error={},/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(this.email)?this.isSignIn||this.displayname&&!(this.displayname.length<3)?!this.passwd||this.passwd.length<4?this.error.passwd="it's too weak!":0:this.error.displayname="it's too short":this.error.email="this is not an email"},logout:function(){return console.log("logout.."),n({url:"/u/logout",method:"GET"}).success(function(){return console.log("logouted."),t.user.data=null,window.location.reload()}).error(function(){return o.send("danger","Failed to Logout. ")})},login:function(){var i,e=this;if(!this.verify())return this.loading=!0,i={newsletter:this.subscribe},n({url:this.isSignIn?"/u/login":"/u/signup",method:"POST",data:$.param(import$({email:this.email,passwd:this.passwd,displayname:this.displayname},this.isSignIn?{}:{config:i})),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})["finally"](function(){return e.loading=!1}).then(function(n){return t.user.data=n.data,gtag("config","GA_TRACKING_ID",{user_id:n.key}),e.ctrl.toggle(!1),t.nexturl?window.location.href=t.nexturl:"/u/login"===window.location.pathname?window.location.href="/":void 0})["catch"](function(t){return 403===t.status?e.isSignIn?e.error.passwd="wrong password":e.error.email="this email is used before.":e.error.email="system busy, try again later."}),this.passwd=""}}),a.run(),console.log("site script initialized")}));