// Generated by LiveScript 1.3.0
module.exports = {
  editable: false,
  change: function(blocks, source){
    var this$ = this;
    clearTimeout(this.handle);
    if (source || this.viewMode) {
      return this.handle = setTimeout(function(){
        return this$.balance();
      }, 10);
    }
  },
  balance: function(){
    var hash, key, list, max, vote, res$, k, v, height, this$ = this;
    hash = {};
    btools.qsAll('.thumb', this.block).map(function(it){
      var box, key;
      box = it.getBoundingClientRect();
      key = Math.round(box.y);
      return (hash[key] || (hash[key] = [])).push([it, box.height]);
    });
    for (key in hash) {
      list = hash[key];
      max = Math.max.apply(null, list.map(fn$));
      vote = {};
      list.map(fn1$);
      res$ = [];
      for (k in vote) {
        v = vote[k];
        res$.push([k, v]);
      }
      vote = res$;
      vote.sort(fn2$);
      height = vote[0][0];
      list.map(fn3$);
    }
    if (this.collab) {
      return this.collab.action.editBlock(this.block, {
        nobreak: true
      });
    }
    function fn$(it){
      return it[1];
    }
    function fn1$(it){
      var that;
      return vote[it[1]] = ((that = vote[it[1]]) ? that : 0) + 1;
    }
    function fn2$(a, b){
      return a[1] - b[1];
    }
    function fn3$(it){
      it[0].style.height = height + "px";
      if (this$.viewMode) {
        return it[0].style.flex = "1 1 auto";
      }
    }
  },
  init: function(){
    var root, dialog, content, inner;
    if (!this.viewMode) {
      return;
    }
    this.balance();
    this.block.addEventListener('click', function(e){
      var target, img;
      if (!e.target || !e.target.classList) {
        return;
      }
      target = e.target;
      while (target && target.classList) {
        if (target.classList.contains('thumb')) {
          break;
        }
        target = target.parentNode;
      }
      if (!target.classList.contains('thumb')) {
        return;
      }
      img = target.style.backgroundImage;
      return btools.qs(".modal-block-gallery").map(function(modal){
        var content;
        $(modal).modal('show');
        content = modal.querySelector('.modal-content > div');
        return content.style.backgroundImage = img;
      });
    });
    if (document.querySelector(".modal-block-gallery")) {
      return;
    }
    root = document.createElement("div");
    root.setAttribute('class', "modal fade modal-block-gallery");
    dialog = document.createElement("div");
    dialog.setAttribute('class', "modal-dialog modal-dialog-centered");
    content = document.createElement("div");
    content.setAttribute('class', "modal-content");
    inner = document.createElement("div");
    inner.setAttribute('class', 'inner');
    root.appendChild(dialog);
    dialog.appendChild(content);
    content.appendChild(inner);
    document.body.appendChild(root);
    return root.addEventListener('click', function(){
      return $(root).modal('hide');
    });
  }
};