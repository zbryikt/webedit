function import$(t,i){var e={}.hasOwnProperty;for(var n in i)e.call(i,n)&&(t[n]=i[n]);return t}var x$;x$=angular.module("webedit",["ldBase","backend"]),x$.factory("httpRequestInterceptor",["global"].concat(function(t){return{request:function(i){return i.headers["X-CSRF-Token"]=t.csrfToken,i}}})),x$.config(["$compileProvider","$httpProvider"].concat(function(t,i){return t.aHrefSanitizationWhitelist(/^\s*(blob:|http:\/\/localhost)|https:\/\/makeweb.io\//),i.interceptors.push("httpRequestInterceptor")})),x$.controller("site",["$scope","$http","$interval","global","ldBase","ldNotify","initWrap"].concat(function(t,i,e,n,r,o,a){return a=a(),import$(t,r),t.notifications=o.queue,t.staticMode=n["static"],t.$watch("user.data",function(i){return i&&i.key?(t.track("uv/"+i.key,(new Date).toISOString().substring(0,10)+"",window.location.pathname),ga("set","dimension1",i.key)):void 0},!0),t.user={data:n.user},t.needlogin=function(i){return t.user.data?window.location.href=i:t.auth.ctrl.toggle(!0)},t.auth=a({init:function(){var i=this;return t.$watch("auth.ctrl.toggled",function(){return i.error={}})},email:"",displayname:"",passwd:"",stick:!1,subscribe:!0,config:{dismissOnEnter:!1,finish:function(){return t.auth.login()}},verify:function(){return this.error={},/^[-a-z0-9~!$%^&*_=+}{\'?]+(\.[-a-z0-9~!$%^&*_=+}{\'?]+)*@([a-z0-9_][-a-z0-9_]*(\.[-a-z0-9_]+)*\.[a-z]{2,}|([0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}))(:[0-9]{1,5})?$/i.exec(this.email)?this.isSignIn||this.displayname&&!(this.displayname.length<3)?!this.passwd||this.passwd.length<4?this.error.passwd="it's too weak!":0:this.error.displayname="it's too short":this.error.email="this is not an email"},logout:function(){return console.log("logout.."),i({url:"/u/logout",method:"GET"}).success(function(){return console.log("logouted."),t.user.data=null,window.location.reload()}).error(function(){return o.send("danger","Failed to Logout. ")})},login:function(){var e,n=this;if(!this.verify())return this.loading=!0,e={newsletter:this.subscribe},i({url:this.isSignIn?"/u/login":"/u/signup",method:"POST",data:$.param(import$({email:this.email,passwd:this.passwd,displayname:this.displayname},this.isSignIn?{}:{config:e})),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}})["finally"](function(){return n.loading=!1}).then(function(i){return t.user.data=i.data,ga("set","&uid",i.key),n.ctrl.toggle(!1),t.nexturl?window.location.href=t.nexturl:"/u/login"===window.location.pathname?window.location.href="/":void 0})["catch"](function(t){return 403===t.status?n.isSignIn?n.error.passwd="wrong password":n.error.email="this email is used before.":n.error.email="system busy, try again later."}),this.passwd=""}}),a.run(),console.log("site script initialized")}));