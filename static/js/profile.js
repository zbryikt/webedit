var x$;x$=angular.module("webedit"),x$.controller("profile",["$scope","$http","$timeout","ldNotify"].concat(function(t,n,e,a){return t.page={"delete":function(e){return n({url:"/d/page/"+e+"/",method:"DELETE"}).then(function(){return t.docs=t.docs.filter(function(t){return t.slug!==e})})}},t.doc={list:[],cur:[],set:function(t){return this.cur=t}},n({url:"/d/me/doc/",method:"GET"}).then(function(n){for(n.data.map(function(t){return t.timestamp=new Date(t.modifiedtime||t.createdtime).getTime(),t.thumbnail?t.thumbnail=t.thumbnail.replace(/\/\d+x\d+\//,"/80x42/"):void 0}),n.data.sort(function(t,n){return n.timestamp-t.timestamp}),t.doc.list=[];n.data.length;)t.doc.list.push(n.data.splice(0,20));return t.doc.cur=t.doc.list[0]}),t.page={thumbnail:function(n){var e,a;return e="1024x1024",a=uploadcare.openDialog(null,null,{imageShrink:e,crop:"free"}),a.done(function(e){var a,i;return a=((i=e.files)?i():[e])[0],t.$apply(function(){return n.thumbnailLoading=!0}),a.done(function(e){return t.$apply(function(){return n.thumbnail=e.cdnUrl+"",n.thumbnailLoading=!1,t.page.update(n)})})})},update:function(e,i){return null==i&&(i=!1),t.loading=!0,n({url:"/d/page/"+e.slug+"/",method:"PUT",data:{title:e.title,thumbnail:e.thumbnail,domain:e.domain,path:e.path,gacode:e.gacode}})["finally"](function(){return t.loading=!0}).then(function(){return t.loading=!1,i&&(e.toggled=!1),a.send("success","saved.")})["catch"](function(){return alert("failed to save. try again later")})}}}));