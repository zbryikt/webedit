function import$(e,r){var n={}.hasOwnProperty;for(var t in r)n.call(r,t)&&(e[t]=r[t]);return e}var x$;x$=angular.module("ldBase"),x$.service("tappay",["$rootScope","$http","global"].concat(function(e,r,n){var t;return t={init:function(e,r,t){return null==t&&(t="sandbox"),n.production?(t="production",e=10305,r="app_phc0rcPCtx0hG0hPjPDca4aoKU8JteYO5ewr8wkG0OMCsRTBbPkerBrqM9Cl"):(t="sandbox",e=10305,r="r3LA58RcpY6WldR7Oh566JybPvzsN1K1Vf0H6E73"),TPDirect.setupSDK(e,r,t)},getPrime:function(e){var r;return r=new Promise(function(r,n){return TPDirect.card.createToken(e.number,e.exp_month,e.exp_year&&2===e.exp_year.length?e.exp_year:(e.exp_year+"").substring(2,4),e.cvc,function(e){return!e||e.status?n(new Error("taypay: create token failed")):r(e)})})}}})),x$.directive("ngCreditCard",["$compile","$timeout"].concat(function(e,r){return{restrict:"A",scope:{model:"=ngModel"},link:function(e){var n,t,o;return n=import$({action:"Purchase"},e.model.config),e.model.loading=!1,e.model.payinfo=t=import$(e.model.payinfo||{},{cvc:null,exp_month:null,exp_year:null,number:null}),e.model.error=o={all:!0},e.model.preact=function(){var r;return e.model.check(null,!0),e.model.error.all?void 0:(e.model.loading=!0,r=e.model.action(e.model.payinfo),r?r.then(function(){return e.$apply(function(){return e.model.loading=!1})})["catch"](function(r){return e.$apply(function(){return e.model.loading=!1}),Promise.reject(new Error(r))}):e.model.loading=!1)},e.model.check=function(n,c){var a,l;return e.model.check.targets||(e.model.check.targets={}),a=e.model.check.targets,a[n]=!0,e.model.check.handler&&r.cancel(e.model.check.handler),l=function(){var r,n,c,l,u,i,m;return r=!function(){var e=[];for(n in a)e.push(n);return e}().length,(r||a.exp_month)&&(o.exp_month=!/^0[1-9]|1[0-2]$/.exec(t.exp_month)),(r||a.exp_year)&&(c=t.exp_year||"",c.length<4&&(c="20"+c),o.exp_year=!/^2[01][0-9]{2}$/.exec(c)||(new Date).getYear()+1900>+c),(r||a.cvc)&&(o.cvc=!/^[0-9][0-9][0-9]$/.exec(t.cvc)),(r||a.name)&&(o.name=!t.name),(r||a.number)&&(t.number=(t.number||"").replace(/-/g,"").trim(),o.number=!/^[0-9]{16}$/.exec(t.number),l=+(t.number||"").substring(0,6),u=+(t.number||"").substring(0,4),i=/^4/.exec(t.number)?"Visa":/^3[47]/.exec(t.number)?"American Express":u>=3528&&3589>=u?"JCB":l>=51e4&&559999>=l||l>=222100&&272099>=l?"MasterCard":""),o.all=!1,o.all=function(){var e,r=[];for(n in e=o)m=e[n],r.push(m);return r}().filter(function(e){return e}).length||function(){var e,r=[];for(n in e=t)m=e[n],r.push(m);return r}().filter(function(e){return!e}).length,e.model.check.targets=[]},c?l():e.model.check.handler=r(function(){return l()},500)}}}}));