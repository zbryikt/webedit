var collab,x$;collab={action:{_info:function(t){var e,n,o,i,r;if(e=[t,collab.doc],n=e[0],o=e[1],!o.data)return[];for(;n&&n.parentNode&&!n.getAttribute("base-block");)n=n.parentNode;return n&&n.getAttribute&&n.getAttribute("base-block")?(i=Array.from(n.parentNode.childNodes).indexOf(n),r=n.getAttribute("base-block"),[n,o,i,r]):[]},deleteBlock:function(t){var e,n,o,i,r;return e=this._info(t),n=e[0],o=e[1],i=e[2],r=e[3],n?o.submitOp([{p:["child",i],ld:o.data.child[i]}]):void 0},insertBlock:function(t){var e,n,o,i,r;return e=this._info(t),n=e[0],o=e[1],i=e[2],r=e[3],n?o.submitOp([{p:["child",i],li:{content:this.blockContent(n),type:r}}]):void 0},blockContent:function(t){return t.querySelector(".block-item > .inner").innerHTML},editBlock:function(t){var e,n,o,i,r,c,l,a,h,d,s,u=[];if(e=this._info(t),n=e[0],o=e[1],i=e[2],r=e[3],n){for(c={last:(o.data.child[i]||{}).content||"",now:this.blockContent(n)},l=fastDiff(c.last,c.now),o.data.child[i]||o.submitOp([{p:["child",i],li:{content:"",type:r}}]),a=0,h=0,d=l.length;d>h;++h)s=l[h],0===s[0]?u.push(a+=s[1].length):1===s[0]?(o.submitOp([{p:["child",i,"content",a],si:s[1]}]),u.push(a+=s[1].length)):u.push(o.submitOp([{p:["child",i,"content",a],sd:s[1]}]));return u}}},init:function(t,e){var n,o,i,r=this;return n=[t,e],this.root=n[0],this.blockManager=n[1],o=window.location.pathname,this.socket=new WebSocket("ws://localhost:9000/"),this.connection=new sharedb.Connection(this.socket),this.pageid=/^\/page\//.exec(o)?o.replace(/^\/page\//,"").replace(/\/$/,""):null,this.doc=i=this.connection.get("doc",this.pageid),i.on("load",function(){var t,n,o,r,c,l=[];if(i.data){for(t=0,o=(n=i.data.child).length;o>t;++t)r=t,c=n[t],l.push(e.prepare(c.content,c.type,r));return l}}),i.fetch(function(){var t;return i.type||(t=i.create({attr:{},child:[]})),i.subscribe(function(t,e){return r.handle(t,e)}),i.on("op",function(t,e){return r.handle(t,e)})})},handle:function(t,e){var n,o,i,r,c=[];if(t&&!e){for(n=0,o=t.length;o>n;++n)i=t[n],i.si||i.sd?c.push(this.root.childNodes[i.p[1]].querySelector(".block-item > .inner").innerHTML=this.doc.data.child[i.p[1]].content):i.li?c.push(this.blockManager.prepare(i.li.content,i.li.type,i.p[1])):i.ld&&(r=this.root.childNodes[i.p[1]],c.push(r.parentNode.removeChild(r)));return c}}},x$=angular.module("webedit"),x$.service("collaborate",["$rootScope"].concat(function(){return collab})),x$.controller("collabInfo",["$scope","$http"].concat(function(){var t;return t=document.querySelector("#collab-info"),t.style.left=800+Math.round((window.innerWidth-800)/2)+"px",t.style.right="auto"}));